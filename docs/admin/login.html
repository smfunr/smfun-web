<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sm.fun Admin - Wallet Login</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            color: #00ff00; 
            font-family: 'Courier New', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .login-container {
            background: #111;
            border: 2px solid #00ff00;
            border-radius: 12px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        .admin-logo {
            font-size: 32px;
            font-weight: bold;
            color: #ffff00;
            margin-bottom: 10px;
        }
        .admin-subtitle {
            color: #888;
            font-size: 14px;
            margin-bottom: 30px;
        }
        .wallet-connect-box {
            background: #222;
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
        }
        .wallet-title {
            color: #00ffff;
            font-size: 20px;
            margin-bottom: 20px;
        }
        .wallet-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .wallet-option {
            background: #333;
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .wallet-option:hover {
            background: #444;
            transform: translateY(-2px);
        }
        .wallet-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }
        .wallet-info {
            flex: 1;
            text-align: left;
        }
        .wallet-name {
            color: #00ff00;
            font-weight: bold;
            font-size: 16px;
        }
        .wallet-desc {
            color: #888;
            font-size: 12px;
            margin-top: 3px;
        }
        .wallet-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            background: #444;
            color: #888;
        }
        .wallet-status.installed {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        .login-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
        }
        .login-status.success {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            color: #00ff00;
            display: block;
        }
        .login-status.error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            color: #ff0000;
            display: block;
        }
        .login-status.info {
            background: rgba(0, 0, 255, 0.1);
            border: 1px solid #0000ff;
            color: #0000ff;
            display: block;
        }
        .admin-note {
            margin-top: 30px;
            padding: 15px;
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid #ffff00;
            border-radius: 8px;
            font-size: 12px;
            color: #ffff00;
        }
        .admin-address {
            font-family: monospace;
            background: #222;
            padding: 8px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 11px;
            word-break: break-all;
        }
        .back-link {
            margin-top: 20px;
            color: #888;
            font-size: 12px;
        }
        .back-link a {
            color: #00ff00;
            text-decoration: none;
        }
        .back-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="admin-logo">sm.fun ADMIN</div>
        <div class="admin-subtitle">Connect your wallet to access admin panel</div>
        
        <div class="wallet-connect-box">
            <div class="wallet-title">Select Wallet</div>
            <div class="wallet-options" id="wallet-options">
                <!-- Wallet options will be populated by JavaScript -->
            </div>
        </div>
        
        <div class="login-status" id="login-status"></div>
        
        <div class="admin-note">
            <strong>‚ö†Ô∏è Admin Access Only</strong><br>
            Only authorized wallet addresses can access the admin panel.
            <div class="admin-address" id="admin-address-display">
                Loading authorized addresses...
            </div>
        </div>
        
        <div class="back-link">
            <a href="../index.html">‚Üê Back to Home</a>
        </div>
    </div>

    <script>
        // ÊéàÊùÉÁöÑÁÆ°ÁêÜÂëòÈí±ÂåÖÂú∞ÂùÄ
        const ADMIN_WALLETS = [
            '0x742d35Cc6634C0532925a3b844Bc9e90F1b6c168', // Á§∫‰æãÂú∞ÂùÄÔºåÊõøÊç¢‰∏∫ÂÆûÈôÖÁÆ°ÁêÜÂëòÂú∞ÂùÄ
            '0x0000000000000000000000000000000000000000' // Ê∑ªÂä†Êõ¥Â§öÁÆ°ÁêÜÂëòÂú∞ÂùÄ
        ];
        
        // Èí±ÂåÖÈÖçÁΩÆ
        const WALLETS = [
            {
                id: 'metamask',
                name: 'MetaMask',
                icon: 'ü¶ä',
                description: 'Browser extension',
                check: () => typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask
            },
            {
                id: 'okx',
                name: 'OKX Wallet',
                icon: 'üî∂',
                description: 'OKX official wallet',
                check: () => typeof window.okxwallet !== 'undefined'
            },
            {
                id: 'coinbase',
                name: 'Coinbase Wallet',
                icon: 'üîµ',
                description: 'Coinbase browser wallet',
                check: () => typeof window.ethereum !== 'undefined' && window.ethereum.isCoinbaseWallet
            },
            {
                id: 'phantom',
                name: 'Phantom',
                icon: 'üëª',
                description: 'Solana wallet',
                check: () => typeof window.solana !== 'undefined' && window.solana.isPhantom
            },
            {
                id: 'walletconnect',
                name: 'WalletConnect',
                icon: '‚ö°',
                description: 'Mobile wallet connection',
                check: () => true // Always available
            }
        ];
        
        // ÂàùÂßãÂåñÈ°µÈù¢
        document.addEventListener('DOMContentLoaded', function() {
            renderWalletOptions();
            updateAdminAddressDisplay();
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÁôªÂΩï
            checkExistingSession();
        });
        
        // Ê∏≤ÊüìÈí±ÂåÖÈÄâÈ°π
        function renderWalletOptions() {
            const container = document.getElementById('wallet-options');
            container.innerHTML = '';
            
            WALLETS.forEach(wallet => {
                const isInstalled = wallet.check();
                
                const option = document.createElement('div');
                option.className = 'wallet-option';
                option.onclick = () => connectWallet(wallet.id);
                
                option.innerHTML = `
                    <div class="wallet-icon">${wallet.icon}</div>
                    <div class="wallet-info">
                        <div class="wallet-name">${wallet.name}</div>
                        <div class="wallet-desc">${wallet.description}</div>
                    </div>
                    <div class="wallet-status ${isInstalled ? 'installed' : ''}">
                        ${isInstalled ? 'Installed' : 'Not Installed'}
                    </div>
                `;
                
                container.appendChild(option);
            });
        }
        
        // Êõ¥Êñ∞ÁÆ°ÁêÜÂëòÂú∞ÂùÄÊòæÁ§∫
        function updateAdminAddressDisplay() {
            const display = document.getElementById('admin-address-display');
            display.innerHTML = ADMIN_WALLETS.map(addr => 
                `<div style="margin-bottom: 5px;">${addr}</div>`
            ).join('');
        }
        
        // ËøûÊé•Èí±ÂåÖ
        async function connectWallet(walletId) {
            const wallet = WALLETS.find(w => w.id === walletId);
            if (!wallet) {
                showStatus('Invalid wallet selected', 'error');
                return;
            }
            
            // Ê£ÄÊü•Èí±ÂåÖÊòØÂê¶ÂÆâË£Ö
            if (!wallet.check() && walletId !== 'walletconnect') {
                showStatus(`${wallet.name} is not installed. Please install it first.`, 'error');
                return;
            }
            
            showStatus(`Connecting to ${wallet.name}...`, 'info');
            
            try {
                let provider;
                
                switch (walletId) {
                    case 'metamask':
                    case 'coinbase':
                        provider = window.ethereum;
                        break;
                    case 'okx':
                        provider = window.okxwallet;
                        break;
                    case 'phantom':
                        provider = window.solana;
                        break;
                    case 'walletconnect':
                        showStatus('WalletConnect integration coming soon', 'info');
                        return;
                    default:
                        throw new Error('Unsupported wallet');
                }
                
                // ËØ∑Ê±ÇË¥¶Êà∑ËÆøÈóÆ
                const accounts = await provider.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                if (!accounts || accounts.length === 0) {
                    throw new Error('No accounts found');
                }
                
                const userAddress = accounts[0];
                
                // Ê£ÄÊü•ÊòØÂê¶ÊòØÁÆ°ÁêÜÂëò
                const isAdmin = ADMIN_WALLETS.some(adminAddr => 
                    adminAddr.toLowerCase() === userAddress.toLowerCase()
                );
                
                if (!isAdmin) {
                    showStatus(`Wallet ${userAddress.substring(0, 8)}... is not authorized for admin access.`, 'error');
                    return;
                }
                
                // Ëé∑ÂèñÈìæID
                const chainId = await provider.request({ 
                    method: 'eth_chainId' 
                });
                
                // Ëé∑Âèñ‰ΩôÈ¢ù
                const balance = await provider.request({
                    method: 'eth_getBalance',
                    params: [userAddress, 'latest']
                });
                
                // ‰øùÂ≠ò‰ºöËØù
                const sessionData = {
                    wallet: walletId,
                    address: userAddress,
                    chainId: parseInt(chainId),
                    balance: formatBalance(balance),
                    loginTime: new Date().toISOString()
                };
                
                localStorage.setItem('admin_wallet_session', JSON.stringify(sessionData));
                
                // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
                showStatus(`‚úÖ Admin access granted! Welcome ${userAddress.substring(0, 8)}...`, 'success');
                
                // ÈáçÂÆöÂêëÂà∞‰ª™Ë°®Êùø
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1500);
                
            } catch (error) {
                console.error('Wallet connection failed:', error);
                showStatus(`Connection failed: ${error.message}`, 'error');
            }
        }
        
        // Ê£ÄÊü•Áé∞Êúâ‰ºöËØù
        function checkExistingSession() {
            try {
                const session = localStorage.getItem('admin_wallet_session');
                if (!session) return;
                
                const sessionData = JSON.parse(session);
                const loginTime = new Date(sessionData.loginTime);
                const now = new Date();
                const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                
                // ‰ºöËØùÊúâÊïàÊúü24Â∞èÊó∂
                if (hoursDiff > 24) {
                    localStorage.removeItem('admin_wallet_session');
                    return;
                }
                
                // Ê£ÄÊü•Èí±ÂåÖÊòØÂê¶‰ªçÁÑ∂ÊòØÁÆ°ÁêÜÂëò
                const isAdmin = ADMIN_WALLETS.some(adminAddr => 
                    adminAddr.toLowerCase() === sessionData.address.toLowerCase()
                );
                
                if (isAdmin) {
                    // Ëá™Âä®ÈáçÂÆöÂêëÂà∞‰ª™Ë°®Êùø
                    window.location.href = 'dashboard.html';
                } else {
                    localStorage.removeItem('admin_wallet_session');
                }
                
            } catch (error) {
                localStorage.removeItem('admin_wallet_session');
            }
        }
        
        // ÊòæÁ§∫Áä∂ÊÄÅÊ∂àÊÅØ
        function showStatus(message, type) {
            const statusEl = document.getElementById('login-status');
            statusEl.textContent = message;
            statusEl.className = `login-status ${type}`;
            
            // Ëá™Âä®ÈöêËóèÈîôËØØÊ∂àÊÅØ
            if (type === 'error') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }
        
        // Ê†ºÂºèÂåñ‰ΩôÈ¢ù
        function formatBalance(balanceWei) {
            if (!balanceWei) return '0';
            
            const wei = BigInt(balanceWei);
            const eth = Number(wei) / 1e18;
            
            if (eth >= 1) {
                return eth.toFixed(4);
            } else if (eth >= 0.001) {
                return eth.toFixed(6);
            } else {
                return eth.toFixed(8);
            }
        }
        
        // ÁõëÂê¨Èí±ÂåÖÂèòÂåñ
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    // Áî®Êà∑Êñ≠ÂºÄËøûÊé•
                    localStorage.removeItem('admin_wallet_session');
                    showStatus('Wallet disconnected', 'info');
                }
            });
            
            window.ethereum.on('chainChanged', () => {
                // ÈìæÂèòÂåñÊó∂Âà∑Êñ∞È°µÈù¢
                window.location.reload();
            });
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sm.fun Admin - Users</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #000; 
            color: #00ff00; 
            font-family: 'Courier New', monospace;
        }
        .admin-header {
            background: #111;
            border-bottom: 2px solid #00ff00;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .admin-logo {
            font-size: 24px;
            font-weight: bold;
            color: #ffff00;
        }
        .admin-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-badge {
            background: linear-gradient(90deg, #ff00ff, #00ffff);
            color: #000;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .admin-nav {
            background: #222;
            border-bottom: 1px solid #00ff00;
            padding: 10px 30px;
            display: flex;
            gap: 20px;
        }
        .nav-item {
            color: #00ff00;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid transparent;
            border-radius: 4px;
        }
        .nav-item:hover, .nav-item.active {
            background: #333;
            border-color: #00ff00;
        }
        .admin-content {
            padding: 30px;
        }
        .page-title {
            font-size: 28px;
            color: #ffff00;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logout-btn {
            background: #333;
            color: #ff0000;
            border: 1px solid #ff0000;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .logout-btn:hover {
            background: #ff0000;
            color: #000;
        }
        .action-bar {
            background: #111;
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .action-btn {
            background: #222;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .action-btn:hover {
            background: #333;
        }
        .action-btn.primary {
            background: linear-gradient(90deg, #00ff00, #00ffff);
            color: #000;
            font-weight: bold;
        }
        .search-box {
            flex: 1;
            padding: 8px;
            background: #222;
            border: 1px solid #00ff00;
            color: #00ff00;
            border-radius: 4px;
            min-width: 200px;
        }
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .users-table th {
            background: #111;
            border: 1px solid #00ff00;
            padding: 12px;
            text-align: left;
            color: #ffff00;
        }
        .users-table td {
            border: 1px solid #333;
            padding: 10px;
        }
        .users-table tr:hover {
            background: #222;
        }
        .user-level {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        .level-bronze { background: #8B4513; color: #fff; }
        .level-silver { background: #C0C0C0; color: #000; }
        .level-gold { background: #FFD700; color: #000; }
        .level-platinum { background: #E5E4E2; color: #000; }
        .level-king { background: linear-gradient(90deg, #ff00ff, #00ffff); color: #000; }
        .invite-code {
            font-family: monospace;
            background: #222;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 20px;
        }
        .page-btn {
            padding: 6px 12px;
            background: #222;
            border: 1px solid #00ff00;
            color: #00ff00;
            cursor: pointer;
            border-radius: 4px;
        }
        .page-btn.active {
            background: #00ff00;
            color: #000;
            font-weight: bold;
        }
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #111;
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffff00;
            margin: 5px 0;
        }
        .stat-label {
            color: #888;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="admin-logo">sm.fun ADMIN</div>
        <div class="admin-user">
            <div>
                <div style="font-weight: bold;" id="admin-email">smfunr@gmail.com</div>
                <div style="font-size: 12px; color: #888;">Super Admin</div>
            </div>
            <div class="user-badge">OWNER</div>
            <button class="logout-btn" id="logout-btn">LOGOUT</button>
        </div>
    </div>
    
    <div class="admin-nav">
        <a href="dashboard.html" class="nav-item">üìä Dashboard</a>
        <a href="users.html" class="nav-item active">üë• Users</a>
        <a href="wallet.html" class="nav-item">üí∞ Wallet</a>
        <a href="ico.html" class="nav-item">üöÄ ICO</a>
        <a href="transactions.html" class="nav-item">üí∏ Transactions</a>
        <a href="config.html" class="nav-item">‚öôÔ∏è Config</a>
    </div>
    
    <div class="admin-content">
        <div class="page-title">
            <span>üë• User Management</span>
            <button class="action-btn primary" onclick="addNewUser()">+ Add New User</button>
        </div>
        
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-label">Total Users</div>
                <div class="stat-value">1,842</div>
                <div style="color: #00ff00; font-size: 12px;">+12.5% today</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Today</div>
                <div class="stat-value">423</div>
                <div style="color: #00ff00; font-size: 12px;">23.0% active rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Points</div>
                <div class="stat-value">1.24M</div>
                <div style="color: #00ff00; font-size: 12px;">Avg 673/user</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Invites</div>
                <div class="stat-value">5,281</div>
                <div style="color: #00ff00; font-size: 12px;">2.87 invites/user</div>
            </div>
        </div>
        
        <div class="action-bar">
            <input type="text" class="search-box" placeholder="Search by email, wallet, or invite code..." id="search-input">
            <select class="action-btn" id="level-filter">
                <option value="">All Levels</option>
                <option value="bronze">Bronze</option>
                <option value="silver">Silver</option>
                <option value="gold">Gold</option>
                <option value="platinum">Platinum</option>
                <option value="king">King</option>
            </select>
            <select class="action-btn" id="status-filter">
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="banned">Banned</option>
            </select>
            <button class="action-btn" onclick="exportUsers()">üì• Export CSV</button>
            <button class="action-btn" onclick="refreshUsers()">üîÑ Refresh</button>
        </div>
        
        <table class="users-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Wallet</th>
                    <th>Level</th>
                    <th>Points</th>
                    <th>Invites</th>
                    <th>Joined</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="users-table-body">
                <!-- Users will be loaded here -->
            </tbody>
        </table>
        
        <div class="pagination" id="pagination">
            <!-- Pagination will be generated here -->
        </div>
    </div>

    <script>
        // Authentication check
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const session = localStorage.getItem('admin_session');
                if (!session) {
                    window.location.href = 'login.html';
                    return;
                }
                
                const sessionData = JSON.parse(session);
                const loginTime = new Date(sessionData.loginTime);
                const now = new Date();
                const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                
                if (hoursDiff > 24) {
                    localStorage.removeItem('admin_session');
                    window.location.href = 'login.html';
                    return;
                }
                
                // Update user display
                const userDisplay = document.getElementById('admin-email');
                if (userDisplay) {
                    userDisplay.textContent = sessionData.email;
                }
                
                // Logout button
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function() {
                        localStorage.removeItem('admin_session');
                        window.location.href = 'login.html';
                    });
                }
                
                // Load users
                loadUsers();
                
                // Setup search
                document.getElementById('search-input').addEventListener('input', function() {
                    filterUsers();
                });
                
                document.getElementById('level-filter').addEventListener('change', filterUsers);
                document.getElementById('status-filter').addEventListener('change', filterUsers);
                
            } catch (error) {
                localStorage.removeItem('admin_session');
                window.location.href = 'login.html';
            }
        });
        
        // Sample user data
        const sampleUsers = [
            { id: 1001, email: 'crypto_trader@proton.me', wallet: '0x8f3a1b2c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9', level: 'king', points: 12500, invites: 42, joined: '2026-02-15', status: 'active' },
            { id: 1002, email: 'eth_maxi@pm.me', wallet: '0x1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a1', level: 'platinum', points: 8500, invites: 28, joined: '2026-02-16', status: 'active' },
            { id: 1003, email: 'btc_holder@tutanota.com', wallet: '0x2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a1b2', level: 'gold', points: 5200, invites: 15, joined: '2026-02-17', status: 'active' },
            { id: 1004, email: 'defi_degen@skiff.com', wallet: '0x3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a1b2c3', level: 'silver', points: 3200, invites: 8, joined: '2026-02-18', status: 'active' },
            { id: 1005, email: 'nft_collector@simplelogin.com', wallet: '0x4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a1b2c3d4', level: 'bronze', points: 1500, invites: 3, joined: '2026-02-19', status: 'active' },
            { id: 1006, email: 'bot_operator@ctemplar.com', wallet: '0x5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a1b2c3d4e5', level: 'gold', points: 6100, invites: 22, joined: '2026-02-19', status: 'inactive' },
            { id: 1007, email: 'arbitrage_bot@proton.me', wallet: '0x6f7a8b9c0d1e2f3a4b5c6d7e8f9a1b2c3d4e5f6', level: 'platinum', points: 9200, invites: 35, joined: '2026-02-20', status: 'active' },
            { id: 1008, email: 'scammer@report.com', wallet: '0x7a8b9c0d1e2f3a4b5c6d7e8f9a1b2c3d4e5f6a7', level: 'bronze', points: 100, invites: 0, joined: '2026-02-20', status: 'banned' }
        ];
        
        let currentUsers = [...sampleUsers];
        let currentPage = 1;
        const usersPerPage = 10;
        
        function loadUsers() {
            const tbody = document.getElementById('users-table-body');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const start = (currentPage - 1) * usersPerPage;
            const end = start + usersPerPage;
            const pageUsers = currentUsers.slice(start, end);
            
            pageUsers.forEach(user => {
                const row = document.createElement('tr');
                
                // Level badge class
                const levelClass = `level-${user.level}`;
                const levelName = user.level.charAt(0).toUpperCase() + user.level.slice(1);
                
                // Status color
                let statusColor = '#00ff00';
                if (user.status === 'inactive') statusColor = '#ffff00';
                if (user.status === 'banned') statusColor = '#ff0000';
                
                // Generate invite code
                const inviteCode = 'SMF' + user.id.toString().padStart(6, '0');
                
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>
                        <div style="font-weight: bold;">${user.email}</div>
                        <div style="font-size: 11px; color: #888;">${inviteCode}</div>
                    </td>
                    <td>
                        <div style="font-family: monospace; font-size: 11px;">
                            ${user.wallet.substring(0, 10)}...${user.wallet.substring(34)}
                        </div>
                    </td>
                    <td><span class="user-level ${levelClass}">${levelName}</span></td>
                    <td>
                        <div style="font-weight: bold; color: #ffff00;">${user.points.toLocaleString()}</div>
                        <div style="font-size: 11px; color: #888;">points</div>
                    </td>
                    <td>
                        <div style="font-weight: bold;">${user.invites}</div>
                        <div style="font-size: 11px; color: #888;">                        invites</div>
                    </td>
                    <td>
                        <div>${user.joined}</div>
                        <div style="font-size: 11px; color: ${statusColor};">${user.status}</div>
                    </td>
                    <td>
                        <button onclick="editUser(${user.id})" style="
                            background: #222;
                            color: #00ff00;
                            border: 1px solid #00ff00;
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 11px;
                            cursor: pointer;
                            margin-right: 5px;
                        ">Edit</button>
                        <button onclick="viewDetails(${user.id})" style="
                            background: #222;
                            color: #00ffff;
                            border: 1px solid #00ffff;
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 11px;
                            cursor: pointer;
                        ">Details</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            updatePagination();
        }
        
        function filterUsers() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const levelFilter = document.getElementById('level-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            
            currentUsers = sampleUsers.filter(user => {
                // Search filter
                const matchesSearch = !searchTerm || 
                    user.email.toLowerCase().includes(searchTerm) ||
                    user.wallet.toLowerCase().includes(searchTerm) ||
                    ('SMF' + user.id.toString().padStart(6, '0')).toLowerCase().includes(searchTerm);
                
                // Level filter
                const matchesLevel = !levelFilter || user.level === levelFilter;
                
                // Status filter
                const matchesStatus = !statusFilter || user.status === statusFilter;
                
                return matchesSearch && matchesLevel && matchesStatus;
            });
            
            currentPage = 1;
            loadUsers();
        }
        
        function updatePagination() {
            const totalPages = Math.ceil(currentUsers.length / usersPerPage);
            const paginationDiv = document.getElementById('pagination');
            
            if (!paginationDiv) return;
            
            paginationDiv.innerHTML = '';
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.textContent = '‚Üê';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadUsers();
                }
            };
            paginationDiv.appendChild(prevBtn);
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'page-btn' + (i === currentPage ? ' active' : '');
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentPage = i;
                    loadUsers();
                };
                paginationDiv.appendChild(pageBtn);
            }
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.textContent = '‚Üí';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    loadUsers();
                }
            };
            paginationDiv.appendChild(nextBtn);
            
            // Page info
            const infoDiv = document.createElement('div');
            infoDiv.style.cssText = `
                margin-left: 15px;
                color: #888;
                font-size: 12px;
                display: flex;
                align-items: center;
            `;
            const start = (currentPage - 1) * usersPerPage + 1;
            const end = Math.min(currentPage * usersPerPage, currentUsers.length);
            infoDiv.textContent = `Showing ${start}-${end} of ${currentUsers.length} users`;
            paginationDiv.appendChild(infoDiv);
        }
        
        function addNewUser() {
            const email = prompt('Enter user email:');
            if (!email) return;
            
            const wallet = prompt('Enter wallet address (0x...):');
            if (!wallet || !wallet.startsWith('0x')) {
                alert('Invalid wallet address');
                return;
            }
            
            const level = prompt('Enter membership level (bronze/silver/gold/platinum/king):', 'bronze');
            if (!['bronze', 'silver', 'gold', 'platinum', 'king'].includes(level)) {
                alert('Invalid level');
                return;
            }
            
            // Add new user
            const newId = Math.max(...sampleUsers.map(u => u.id)) + 1;
            const newUser = {
                id: newId,
                email: email,
                wallet: wallet,
                level: level,
                points: 1000,
                invites: 0,
                joined: new Date().toISOString().split('T')[0],
                status: 'active'
            };
            
            sampleUsers.unshift(newUser);
            currentUsers.unshift(newUser);
            
            alert(`User ${email} added successfully with ID: ${newId}`);
            loadUsers();
        }
        
        function editUser(userId) {
            const user = sampleUsers.find(u => u.id === userId);
            if (!user) return;
            
            const newLevel = prompt(`Edit ${user.email} level (current: ${user.level}):`, user.level);
            if (newLevel && ['bronze', 'silver', 'gold', 'platinum', 'king'].includes(newLevel)) {
                user.level = newLevel;
                loadUsers();
                alert('User level updated');
            }
            
            const newPoints = prompt(`Edit ${user.email} points (current: ${user.points}):`, user.points);
            if (newPoints && !isNaN(newPoints)) {
                user.points = parseInt(newPoints);
                loadUsers();
                alert('User points updated');
            }
        }
        
        function viewDetails(userId) {
            const user = sampleUsers.find(u => u.id === userId);
            if (!user) return;
            
            const inviteCode = 'SMF' + user.id.toString().padStart(6, '0');
            
            const details = `
User Details:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
ID: ${user.id}
Email: ${user.email}
Wallet: ${user.wallet}
Level: ${user.level.toUpperCase()}
Points: ${user.points.toLocaleString()}
Invites: ${user.invites}
Invite Code: ${inviteCode}
Joined: ${user.joined}
Status: ${user.status.toUpperCase()}

Actions:
‚Ä¢ Edit level/points
‚Ä¢ Reset password
‚Ä¢ View transaction history
‚Ä¢ Check invite tree
‚Ä¢ Export user data
            `;
            
            alert(details);
        }
        
        function exportUsers() {
            const csv = [
                ['ID', 'Email', 'Wallet', 'Level', 'Points', 'Invites', 'Joined', 'Status', 'Invite Code'],
                ...currentUsers.map(user => [
                    user.id,
                    user.email,
                    user.wallet,
                    user.level,
                    user.points,
                    user.invites,
                    user.joined,
                    user.status,
                    'SMF' + user.id.toString().padStart(6, '0')
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `smfun_users_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            alert(`Exported ${currentUsers.length} users to CSV`);
        }
        
        function refreshUsers() {
            // Simulate API call
            document.querySelector('.action-bar').style.opacity = '0.7';
            setTimeout(() => {
                document.querySelector('.action-bar').style.opacity = '1';
                loadUsers();
                alert('Users refreshed');
            }, 500);
        }
    </script>
</body>
</html>
